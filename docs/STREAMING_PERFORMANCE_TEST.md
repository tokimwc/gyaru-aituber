# VOICEVOXストリーミング音声合成 パフォーマンステスト結果

## 📅 テスト実施日
2025年1月8日

## 🎯 テスト目的
ストリーミング音声合成方式のパフォーマンスを測定し、従来の一括合成方式と比較する。

## 🔧 テスト環境

- **VOICEVOXバージョン**: 0.14.4
- **話者ID**: 8 (春日部つむぎノーマル)
- **テスト文数**: 5文
- **総文字数**: 107文字
- **テスト文**:
  1. あーし、今日マジでテンション上がってるんだけど！
  2. せんぱいって、プログラミングめっちゃ得意じゃん？
  3. あーしもコード書くの好きなんだよね〜。
  4. でもさ、バグ出たときってマジ萎えるよね。
  5. エラーログ見るの、ガチで苦手なんだけど。

## 📊 テスト結果

### 1. 従来方式（一括合成）

**概要**: 全文を一度に合成してから再生

| 項目 | 値 |
|------|-----|
| Query時間 | 0.039秒 |
| Synthesis時間 | 0.218秒 |
| **合計処理時間** | **0.332秒** |
| 音声サイズ | 760,876バイト |
| 処理速度 | 322.10文字/秒 |
| **ユーザー待機時間** | **0.332秒** |

**特徴**:
- 全文の合成が完了するまでユーザーは待つ必要がある
- 処理速度は速いが、体感速度は遅い

### 2. 新方式（ストリーミング合成）

**概要**: 文単位で順次合成・再生

| 項目 | 値 |
|------|-----|
| 平均Query時間 | 0.010秒/文 |
| 平均Synthesis時間 | 0.125秒/文 |
| 平均合計時間 | 0.156秒/文 |
| 全体処理時間 | 0.778秒 |
| 処理速度 | 137.50文字/秒 |
| **最初の音声再生開始まで** | **0.167秒** ⭐ |

**各文の処理時間**:
1. 0.167秒（Query: 0.011秒, Synthesis: 0.133秒）
2. 0.161秒（Query: 0.010秒, Synthesis: 0.123秒）
3. 0.155秒（Query: 0.010秒, Synthesis: 0.126秒）
4. 0.147秒（Query: 0.009秒, Synthesis: 0.120秒）
5. 0.148秒（Query: 0.008秒, Synthesis: 0.120秒）

**特徴**:
- 最初の文が合成されたら即座に再生開始
- ユーザーは最初の音声を聞きながら、次の文の合成が進行
- 体感速度が大幅に向上

### 3. 並列合成（理論上の最大性能）

**概要**: 全文を同時に並列合成

| 項目 | 値 |
|------|-----|
| 並列処理時間 | 0.715秒 |
| 総文字数 | 107文字 |
| 総音声サイズ | 704,732バイト |
| 処理速度 | 149.67文字/秒 |

**特徴**:
- 理論上の最大性能を測定
- 実際のストリーミングでは順次処理のため、この速度は参考値

## 🚀 改善効果

### 体感速度の向上

| 指標 | 従来方式 | 新方式 | 改善率 |
|------|---------|--------|--------|
| **ユーザー待機時間** | 0.332秒 | **0.167秒** | **49.9%短縮** ⭐ |
| 待機時間短縮 | - | 0.166秒 | - |

### 詳細分析

1. **最初の音声再生開始までの時間**
   - 従来方式: 0.332秒（全文合成完了まで待つ）
   - 新方式: 0.167秒（最初の文のみ合成）
   - **改善**: 約50%短縮

2. **全体処理時間**
   - 従来方式: 0.332秒
   - 新方式: 0.778秒
   - **注意**: 新方式は全体処理時間は長いが、ユーザーは最初の音声を0.167秒で聞けるため、体感速度は向上

3. **処理速度**
   - 従来方式: 322.10文字/秒（一括処理のため高速）
   - 新方式: 137.50文字/秒（順次処理のためやや遅い）
   - **結論**: 処理速度は低下するが、体感速度は大幅に向上

## 💡 結論

### ✅ ストリーミング方式の効果

1. **体感速度の大幅な向上**
   - ユーザーが最初の音声を聞くまでの待ち時間が**約50%短縮**
   - 従来方式: 0.332秒待つ必要があった
   - 新方式: 0.167秒で最初の音声が聞ける

2. **ユーザー体験の改善**
   - 文単位で順次再生されるため、より自然な会話感
   - 最初の音声を聞きながら、次の文の合成が進行（並列処理）

3. **実用性**
   - 全体処理時間は長くなるが、ユーザーの体感速度は向上
   - 実際の使用では、ユーザーは最初の音声を聞きながら待つため、体感速度が重要

### 📈 推奨事項

- **ストリーミング方式を採用**: ユーザー体験の大幅な改善が確認された
- **LLM推論との組み合わせ**: LLMが文を生成するたびに音声合成を開始することで、さらに体感速度が向上する可能性がある
- **最適化の余地**: 並列合成の結果から、VOICEVOXの処理能力は十分にあるため、さらなる最適化が可能

## 🔍 技術的考察

### Query時間 vs Synthesis時間

- **Query時間**: 平均0.010秒/文（非常に高速）
- **Synthesis時間**: 平均0.125秒/文（処理の大部分）
- **結論**: Synthesis時間がボトルネック。GPU処理の最適化が効果的

### 並列処理の可能性

- 並列合成テストでは0.715秒で5文を処理
- 順次処理では0.778秒
- **差**: 0.063秒（約8%の差）
- **結論**: 並列処理の効果は限定的。順次処理で十分な性能

### メモリ効率

- 従来方式: 760,876バイト（1つの大きなBlob）
- 新方式: 平均約140,946バイト/文（5つの小さなBlob）
- **結論**: 文単位でBlobを作成・解放するため、メモリ効率が向上

## 📝 今後の改善点

1. **LLM推論との統合**
   - LLMが文を生成するたびに即座に音声合成を開始
   - さらに体感速度が向上する可能性

2. **キャッシュ機能**
   - よく使われる文をキャッシュして、合成時間を短縮

3. **音声品質の最適化**
   - 合成パラメータの調整で、品質と速度のバランスを最適化

4. **エラーハンドリングの強化**
   - 音声合成が失敗した場合のリトライ機能
   - 部分的な失敗時のフォールバック処理

---

**テスト実施者**: 自動テストツール  
**テストツール**: `tests/test_streaming_performance.html`  
**スクリーンショット**: `performance_test_results.png`
